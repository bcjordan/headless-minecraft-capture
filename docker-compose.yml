services:
  mc-server:
    image: itzg/minecraft-server
    environment:
      EULA: "TRUE"
      ONLINE_MODE: "FALSE"
      VERSION: "1.20.4"
      MOTD: "Recording Server"
    ports:
      - "25565:25565"
    healthcheck:
      test: ["CMD", "mc-health"]
      interval: 10s
      timeout: 5s
      retries: 20

  recorder:
    build: ./recorder
    environment:
      MC_HOST: mc-server
      MC_PORT: 25565
    volumes:
      - ./recordings:/output
    depends_on:
      mc-server:
        condition: service_healthy

  web:
    build: ./web
    ports:
      - "3001:3000"
    volumes:
      - ./recordings:/app/recordings
